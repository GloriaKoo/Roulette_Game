<!DOCTYPE html>
<html lang="zh-tw">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Player Information</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="../img/3425938.png" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Simple line icons-->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" rel="stylesheet" />
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css" />
        <!--載入adminlte.min.css-->
        <link type="text/css" rel="stylesheet" href="css/adminlte.min.css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body>
        <!-- 選單-->
        <a class="menu-toggle rounded" href="#"><i class="fas fa-bars"></i></a>
        <nav id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand"><a href="index.html">Content</a></li>
                <li class="sidebar-nav-item"><a href="index.html">Home</a></li>
                <li class="sidebar-nav-item"><a href="game.html">Roulette Game</a></li>
                <li class="sidebar-nav-item"><a href="#page-top">Player Information</a></li>
                <li class="sidebar-nav-item"><a href="rule.html">Rule</a></li>
            </ul>
        </nav>
        <div class="history-content-header"></div>
        <section class="content">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-md-6">
                        <div class="card card-info" id="contract_card">
                            <div class="card-header">
                                <h2 class="card-title"><b>Contract</b></h2>
                            </div>
                            <div class="card-body">
                                <div class="form-group row">
                                    <label for="contract_address" class="col-md-2 col-form-label">Address</label>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="contract_address"/>
                                            <!-- <div class="input-group-prepend">
                                                <button type="button" class="btn btn-warning"
                                                    id="contract_address_btn">Connect</button>
                                            </div> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="contract_eth_balance" class="col-md-2 col-form-label">ETH Balance</label>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="contract_eth_balance"
                                                readonly />
                                            <div class="input-group-append">
                                                <span class="input-group-text"><b>ETH</b></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="contract_lot_balance" class="col-md-2 col-form-label">Lot Balance</label>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="contract_lot_balance"
                                                readonly />
                                            <div class="input-group-append">
                                                <span class="input-group-text"><b>LOT</b></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-6">
                        <div class="card card-primary">
                            <div class="card-header">
                                <h2 class="card-title"><b>Account</b></h2>
                            </div>
                            <div class="card-body">
                                <div class="form-group row">
                                    <label for="account_address" class="col-md-2 col-form-label">Address</label>
                                    <div class="col-md-10">
                                        <input type="text" class="form-control" id="account_address" readonly />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="account_eth_balance" class="col-md-2 col-form-label">ETH Balance</label>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="account_eth_balance"
                                                readonly />
                                            <div class="input-group-append">
                                                <span class="input-group-text"><b>ETH</b></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="account_lot_balance" class="col-md-2 col-form-label">Lot Balance</label>
                                    <div class="col-md-10">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="account_lot_balance"
                                                readonly />
                                            <div class="input-group-append">
                                                <span class="input-group-text"><b>LOT</b></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-6">
                        <div class="card card-danger">
                            <div class="card-header">
                                <h2 class="card-title"><b>購買/兌回</b></h2>
                            </div>
                            <div class="card-body">
                                <div class="form-group row">
                                    <label class="col-md-1 col-form-label">籌碼</label>
                                    <div class="col-md-5">
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="buy_eth" value="1" min="1"
                                                max="10000" step="1" />
                                            <div class="input-group-append">
                                                <span class="input-group-text"><b>Wei</b></span>
                                            </div>
                                        </div>
                                    </div>
                                    <label class="col-md-1 col-form-label text-center">=</label>
                                    <div class="col-md-5">
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="buy_lot" readonly />
                                            <div class="input-group-append">
                                                <span class="input-group-text"><b>LOT</b></span>
                                                <button type="button" class="btn btn-danger" id="buy_lot_btn">購買</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-6">
                        <div class="card card-secondary">
                            <div class="card-header">
                                <h2 class="card-title"><b>歷史紀錄</b></h2>
                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" id="reload" data-card-widget="collapse">
                                        <i class="fas fa-refresh"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="form-group row">
                                    <div class="col-md-12">
                                        <table class="table table-bordered table-hover" id="History_table">
                                            <thead>
                                                <tr>
                                                    <th>序號</th>
                                                    <th>下注標的</th>
                                                    <th>下注金額</th>
                                                    <th>開獎號碼</th>
                                                    <th>本局損益</th>
                                                </tr>
                                            </thead>
                                            <tbody id="History"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        </article>
        
        <!-- Scroll to Top Button-->
        <a class="scroll-to-top rounded" href="#page-top"><i class="fas fa-angle-up"></i></a>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.3/web3.min.js"></script>
        <script src="js/scripts.js"></script>
        <script src="js/con_ABI.js"></script>
        <script src="js/contract.js"></script>
        <script src="js/wallet.js"></script>
        <script>
            //查詢個人歷史紀錄
            $('#reload').click(function () 
            {
                updateHistory();
            });
            
            //執行買幣
            $("#buy_lot").val($("#buy_eth").val());

            $("#buy_eth").keyup(function () 
            {
                UpdateBuyLot();
            });

            $("#buy_eth").change(function () 
            {
                UpdateBuyLot();
            });

            $('#buy_lot_btn').click(async function(){
                var n = parseInt($('#buy_eth').val());
                try{
                    await buyTokens(contract, accounts[0], n);
                    updatelot();
                    var total_supply = await getTotalSupply(contract);
                    console.log("total_supply",total_supply);
                    $("#contract_lot_balance").val(total_supply);

                }catch(error){
                    alert(error);
                }
            })
        </script>
    </body>
</html>